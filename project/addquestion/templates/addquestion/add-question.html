<!DOCTYPE html>

<html lang="ru">
	<head>
        {% load static %}
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<meta name="robots" content="index,follow">

			<title>КОЛИБРИНА - Добавить вопрос | Добавить авторский турни</title>

		<meta name="description" content="">
		
		{% include 'main/headPiece.html' %}

		<link rel="stylesheet" href="{% static 'css/pages/addquestion.css' %}">

		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	    
	    <!--[if lt IE 9]>
	      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	    <![endif]-->
	</head>
	<body>
		{% include "main/header.html" %}
        {% if not errors %}
		<div class="addquest_info"><p>Внимание авторам!<a class="red" href="#"> Обязательно к прочтению!</a></p></div>
		<form class="container addquest_wrap" method="post">{% csrf_token %}
			<div class="addquest_author">{% if request.user.hideMyName == 0 %}{{ USER }}{% else %}{{ request.user }}{% endif %}</div>
            {{ form.author }}
            <div class="addquest_theme-category">
                <div class="">
					<select name="category" id="category" onchange="get_themes($('#category').val())">
                        <option value="">Категория темы</option>
                        {% for category in categories %}
    						<option value="{{ category.id }}">{{ category }}</option>
                        {% endfor %}
					</select>
					<div class="addtheme_wrap">
						<select name="theme" id="theme">
							<option value="">Тема вопроса</option>
						</select>
						<div class="addtheme" title="Добавить свою тему"><span>+</span></div>
					</div>
				</div>
			<div class="addquest_complexity">
				<span>Уровень сложности:</span>
                {% for radio in form.difficulty %}
				<div class="complexity_btn">
                    {{ radio }}
				</div>
                {% endfor %}
			</div>
			</div>

			<textarea name="question" maxlength="350" required id="id_question" class="addquest_question" placeholder="Текст вопроса (не более 350 символов)"></textarea>
			<div class="reply_var">
				<span>Варианты ответов:</span>
				<input type="text" name="corectAnsw" maxlength="64" required="" id="id_corectAnsw" placeholder="Правильный ответ" class="correct_ans">
				<input type="text" name="answer2" maxlength="64" required="" id="id_answer2" placeholder="Вариант">
				<input type="text" name="answer3" maxlength="64" required="" id="id_answer3" placeholder="Вариант">
				<input type="text" name="answer4" maxlength="64" required="" id="id_answer4" placeholder="Вариант">
			</div>
			<div class="tournir_list">
				<span>Куда вносится список турниров:</span>
				<div class="addquest_table">
					<table>
					  <tr>
					    <th>00.00.0000</th>
					    <th>00.00</th>
					    <th>просто в базу</th>
					    <th>на усмотрение редактора</th>
					  </tr>
					  <tr>
					    <td>25.05.2020</td>
					    <td>17.00</td>
					    <td>ЭЛМН0001</td>
					    <td>Эрудит лото/Марафон недели</td>
					  </tr>
					  <tr>
					    <td>25.05.2020</td>
					    <td>17.00</td>
					    <td>ЭЛМН0001</td>
					    <td>Эрудит лото/Марафон недели</td>
					  </tr>
					  <tr>
					    <td>25.05.2020</td>
					    <td>17.00</td>
					    <td>ЭЛМН0001</td>
					    <td>Эрудит лото/Марафон недели</td>
					  </tr>
					   <tr>
					    <td>25.05.2020</td>
					    <td>17.00</td>
					    <td>ЭЛМН0001</td>
					    <td>Эрудит лото/Марафон недели</td>
					  </tr>
					</table>
				</div>
			</div>
			<div class="addquest_btns">
				<button class="addquest_btn">Добавить вопрос</button>
				<a class="addquest_btn">Добавить вопрос и продолжить добавление</a>
			</div>
		</form>
        {% endif %}
		{% include "main/footer.html" %}

		<script>
            function get_themes(category){
                if (category === ''){
                    $('#theme option').remove()
                    $('#theme').prepend('<option value="">Тема вопроса</option>')
                }
                else {
                    console.log('csrfmiddlewaretoken={{ csrf_token }}&cat=' + category)
                    $.ajax({
                    type:'POST', url:`${window.location.origin}/add-question/get-themes/`,
                    data:'csrfmiddlewaretoken={{ csrf_token }}&cat=' + category,
                    success: function(msg){
                        {#alert(msg)#}
                        let themes = msg.split('\\|/')
                        $('#theme option').remove()
                        $('#theme').prepend('<option value="">Тема вопроса</option>')
                        for (let index = 0; index < themes.length; ++index) {
                            if (themes[index]!==''){
                                let theme = themes[index].split('/|\\')
                            $('#theme').prepend('<option value="'+ theme[1] +'">' + theme[0] + '</option>')}
                        }
                    },
                    {#error: function (msg){console.log(msg.responseText)}#}
                    }
                    )
                }
            }
			$(document).ready(function() {
				$("header nav a:nth-child(4) > span").addClass("select");
				$(".title > h2 > strong").html("Добавить вопрос | Добавить авторский турнир");
			});
		</script>


	</body>
</html>
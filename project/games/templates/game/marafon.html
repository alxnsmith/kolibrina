<!DOCTYPE html>

<html lang="ru">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="robots" content="index,follow">

    <title>КОЛИБРИНА - Марафон</title>

    <meta name="description" content="">

    {% include 'main/headPiece.html' %}

    <link rel="stylesheet" href="{% static "css/style.min.css" %}">
    <link rel="stylesheet" href="{% static "css/pages/marafon.min.css" %}">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

{% include "main/header.html" %}
<div class="container">

    <div class="marafon-top">
        <div class="text-information">
            <p>Текстовая информация</p>
        </div>
        <div class="marafon-top_right">
            <div class="btn_choose">Ваш выбор</div>
            <div class="marafon-timer" id="timer">00:00</div>
        </div>
    </div>


    <form action="" method="POST" class="game">
        <div class="topics">
            {% for i in marafon_info.number_of_theme_blocks %}
                <div class="topic">
                    <div class="topic-name">__________</div>
                    <div class="topic-points">
                        <div class="topic-point" data-pos="1">100</div>
                        <div class="topic-point" data-pos="2">200</div>
                        <div class="topic-point" data-pos="3">300</div>
                        <div class="topic-point" data-pos="4">400</div>
                        <div class="topic-point" data-pos="5">500</div>
                        <div class="topic-point" data-pos="6">600</div>
                        <div class="topic-point" data-pos="7">700</div>
                        <div class="topic-point" data-pos="8">800</div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="row">
            <div class="col-sm-12 col-md-7 col-lg-7">
                <div class="game__question">
                    ___________________________________________________?
                </div>
                <div class="game__options">
                    <label>
                        <input class="answer" type="radio" name="answer" value="" checked>
                        _______
                        <span></span>
                    </label>
                    <label>
                        <input class="answer" type="radio" name="answer" value="">
                        _______
                        <span></span>
                    </label>
                    <label>
                        <input class="answer" type="radio" name="answer" value="">
                        _______
                        <span></span>
                    </label>
                    <label>
                        <input class="answer" type="radio" name="answer" value="">
                        _______
                        <span></span>
                    </label>
                </div>
                <div class="game__button">
                    <a class="btn" href="#">Пропустить</a>
                </div>
                <div class="correct_answer">
                    <span>Правильный ответ:</span>
                </div>
            </div>
            <div class="col-sm-12 col-md-5 col-lg-5 rating">
                <div class="rating-title">Рейтинг топ 15 марафона</div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">1</span>. <span class="username"></span><span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">2</span>. <span class="username"></span><span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">3</span>. <span class="username"></span><span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">4</span>. <span class="username"></span><span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">5</span>. <span class="username"></span><span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">6</span>. <span class="username"></span><span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">7</span>. <span class="username"></span><span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">8</span>. <span class="username"></span><span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">9</span>. <span class="username"></span><span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">10</span>. <span class="username"></span> <span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">11</span>. <span class="username"></span> <span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">12</span>. <span class="username"></span> <span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">13</span>. <span class="username"></span> <span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">14</span>. <span class="username"></span> <span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="rating-place" id="username">
                    <div class="rt-user"><span class="num">15</span>. <span class="username"></span> <span
                            class="last_name"></span> <span class="first_name"></span> <span class="city"></span></div>
                    <div class="rt-points"> = <span class="score">0</span> (+<span class="score_delta">0</span>)</div>
                </div>
                <div class="players">ИГРОКИ (<span id="online_players">0</span>)</div>
                <div class="viewers">ЗРИТЕЛИ (<span id="online_watchers">0</span>)</div>
            </div>
        </div>
    </form>
    <div class="user-stat">
        <div class="user-avatar user_div">
            <img class="user_img" src="{{ user_info.avatar }}"/>
            <div class="user-name">
                <span>{{ user_info.last_name }}</span>
                <span>{{ user_info.first_name }}</span>
                <span><b>г.{{ user_info.city }}</b></span>
            </div>
        </div>
        <div class="user-points_table user_div">

            <div class="user-points_table_col">
                <div class="user-points_table_row">баллы за игру:</div>
                <div class="user-points_table_row cr">0</div>
            </div>
            <div class="user-points_table_col">
                <div class="user-points_table_row">баллы за месяц:</div>
                <div class="user-points_table_row cr">{{ user_info.month_score }}</div>
            </div>
            <div class="user-points_table_col">
                <div class="user-points_table_row">баллы всего:</div>
                <div class="user-points_table_row cr">{{ user_info.total_score }}</div>
            </div>
        </div>
        <div class="league_place user_div">
            <span><b>Место <BR>в лиге</b></span>
            <div class="league_count">123 / 878</div>
        </div>
        <div class="author user_div marafon_author">
            <span class="marafon_author-title">Автор марафона №{{ marafon_info.id }}</span>
            <span class="marafon_author-name">{{ marafon_info.author_firstname }} {{ marafon_info.author_lastname }}, {{ marafon_info.author_city }}</span>
        </div>

        <div class="marafon_league">
            {{ user_info.league }}
        </div>
        <div class="user-lvl user_div">
            <span>Уровень игрока</span>
            <div class="lvl">{{ user_info.level.level }} / {{ user_info.level.numLevel }}</div>
            {% if not marafon_info.time_to_start %}{% include 'game/blocks/wait_block.html' %}{% endif %}
        </div>
    </div>
</div>

{% include "main/footer.html" %}
<script src="{% static 'js/games/libs/time_counter.js' %}"></script>
<script src="{% static 'js/games/libs/marafon_week/wait_timer.js' %}"></script>
<script src="{% static 'js/games/libs/marafon_week/top_fifteen.js' %}"></script>
<script src="{% static 'js/games/libs/marafon_week/render.js' %}"></script>
<script>
    "use strict"

    let marafon_socket = new WebSocket('wss://' + window.location.host + '/ws/marafon-week/')
    marafon_socket.onopen = () => {
        let time_to_response
        let rime_to_choose


        let render = new Render()

        marafon_socket.onmessage = e => {
            let data = JSON.parse(e.data)
            console.log(data)
            if (data.type === 'online_watchers') {
                render.update_online('watchers', data.online)
            } else if (data.type === 'online_players') {
                render.update_online('players', data.online)
            } else if (data.type === 'themes_list') {
                render.fill_themes(data.themes)
            } else if (data.type === 'timer') {
                render.time_to_response = data.timer
                start_timer()
            } else if (data.type === 'top_fifteen') {
                render.update_top_fifteen(data.rows)
            } else if (data.type === 'end_game'){
                show_modal_notification('Игроков мало, игра окончена!')
            }
        }

        function send_start() {
            marafon_socket.send(JSON.stringify({'type': 'event', 'event': 'time_to_start'}))
        }

        let url = window.location.origin + '/marafon-week/?info'
        sendRequest('get', url).then(data => {
            return data
        }).then(marafon_info => {
            let date_start = marafon_info.date_start * 1000
            !marafon_info.time_to_start && start_timer(date_start, send_start)
        })
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelector(".title > h2 > strong").innerHTML = 'Марафон'
        document.querySelector("header nav a:nth-child(2) > span").classList.add('select')
    })
</script>

</body>
</html>
<!DOCTYPE html>

<html lang="ru">
	<head>
        {% load static %}
		<meta charset="UTF-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<meta name="robots" content="index,follow">

			<title>КОЛИБРИНА - Главная</title>

		<meta name="description" content="">

				{% include 'main/headPiece.html' %}

		<link rel="stylesheet" href="{% static 'css/style.css' %}">

		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	    
	    <!--[if lt IE 9]>
	      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	    <![endif]-->
	</head>
	<body>

		        {% include "main/header.html"%}


		<div class="container">

			<div class="text-information">
				<p>Текстовая информация</p>
			</div>

			<div class="game_nav">
				<div class="game_nav-btns j-c-Center">
					<a href="javascript:void(0)" id="q_num" class="act">01</a>
					<a href="javascript:void(0)" id="q_num">02</a>
					<a href="javascript:void(0)" id="q_num">03</a>
					<a href="javascript:void(0)" id="q_num">04</a>
					<a href="javascript:void(0)" id="q_num">05</a>
					<a href="javascript:void(0)" id="q_num">06</a>
					<a href="javascript:void(0)" id="q_num">07</a>
					<a href="javascript:void(0)" id="q_num">08</a>
					<a href="javascript:void(0)" id="q_num">09</a>
					<a href="javascript:void(0)" id="q_num">10</a>
					<a href="javascript:void(0)" id="q_num">11</a>
					<a href="javascript:void(0)" id="q_num">12</a>
				</div>
			</div>
			<div class="text-author"></div>

			<form action="" method="POST" class="game">
				<div class="row">
					<div class="col-sm-8 col-md-8 col-lg-8">
						<div class="game__question">
							Сколько медведей на картине И. Шишкина "Утро в сосновом лесу"?
						</div>
						<div class="game__options">
							<label id="answer">
								<input type="radio" name="answer" value="Два">
								Два
								<span></span>
							</label>
							<label id="answer">
								<input type="radio" name="answer" value="Три">
								Три
								<span></span>
							</label>
							<label id="answer">
								<input type="radio" name="answer" value="Четыре">
								Четыре
								<span></span>
							</label>
							<label id="answer">
								<input type="radio" name="answer" value="Пять">
								Пять
								<span></span>
							</label>
						</div>
						<div class="game__button">
							<a>Ответить</a>
						</div>
					</div>
					<div class="col-sm-4 col-md-4 col-lg-4 game__functional">
						<a href="#">Спросить у мастера</a>
						<a href="#">Убрать 2 ответа</a>
						<a href="#">Пропустить вопрос</a>
						<a href="#">Ответ со второй попытки</a>
						<a href="#">Добавить баллы на счёт</a>
					</div>
				</div>
			</form>

			<div class="estimate-author">
				<span>Оцените автора: </span>
				<a href="#">0</a>
				<a href="#">1</a>
				<a href="#">2</a>
				<a href="#">3</a>
				<a href="#">4</a>
				<a href="#">5</a>
				<a href="#">6</a>
				<a href="#">7</a>
				<a href="#">8</a>
				<a href="#">9</a>
				<a href="#">10</a>
			</div>
		</div>

		{% include "main/footer.html"%}
		<script>
			$(document).ready(function() {
				$(".title > h2 > strong").html("Тренировка Эрудит-Лото");
			});
		</script>
        <script>
            q_nums = document.querySelectorAll('a#q_num')
            let q_act = 0
            let score = 0
            let deltaScore
            let currentQuest
            let quest_list = {{ quest_list|safe }};

            function initGameField(a = 2) {
                if (q_act>0) {
                    q_nums[q_act - 1].classList.remove('act')
                }
                currentQuest = quest_list[q_act]
                q_nums[q_act].classList.add('act')
                document.querySelector('.text-author').innerHTML = `<span>Автор вопроса: ${currentQuest['author']}</span>`
                document.querySelector('.game__question').innerHTML = `${currentQuest['question']}`
                let answers = document.querySelectorAll('label#answer')
                let c = Math.floor(Math.random()*4)
                answers[c].innerHTML = `<input type="radio" name="answer" value="${quest_list[q_act]['corectAnsw']}">${currentQuest['corectAnsw']}<span></span>`
                for(let i = 0; i < 4; i++) {
                    if (i !== c) {
                        answers[i].innerHTML = `<input type="radio" name="answer" value="${currentQuest[`answer${a}`]}">${currentQuest[`answer${a}`]}<span></span>`
                        a++
                    }}
                q_act++
                console.log(q_act)
                console.log(currentQuest)

                }

            let league = '{{ league }}'
            function startDeltaScore(){
                if (league === 'J'){
                    deltaScore = [3, 5, 7, 9, 15, 18, 21, 24, 32, 37, 41, 45]
                } else if (league === 'L'){
                    deltaScore = [5, 7, 9, 18, 21, 24, 37, 41, 45, 65, 70, 100]
                } else if (league === 'Z'){
                    deltaScore = [7, 9, 18, 21, 24, 37, 41, 45, 65, 70, 91, 100]
                } else if (league === 'M'){
                    deltaScore = [18, 21, 24, 32, 37, 41, 45, 60, 65, 70, 91, 100]
                } else if (league === 'P'){
                    deltaScore = [32, 37, 41, 45, 55, 60, 65, 70, 77, 84, 91, 100]
                }
                console.log(`Score delta: ${deltaScore}`)
            }
            function check() {
                    let inp = document.getElementsByName('answer');
                    for (let i = 0; i < inp.length; i++) {
                        if (inp[i].type === "radio" && inp[i].checked) {
                            return inp[i].value;
                        }
                    }
                }

            startDeltaScore()
            initGameField()
            document.querySelector('.game__button').onclick = function() {
            if(check() === undefined){
               alert('!!!')
            }
            else {

                console.log(`Score delta: ${deltaScore}`)
                console.log(deltaScore)


                if(check() === quest_list[q_act-1]['corectAnsw']){score+=deltaScore[q_act-1]}
                else {
                    window.location.replace(`{% url 'result-game' %}?status=lose&`+
                    `question=${encodeURIComponent(quest_list[q_act-1]['question'])}&`+
                    `correctAnswer=${encodeURIComponent(quest_list[q_act-1]['corectAnsw'])}&`+
                    `score=${score}&`+`author=${encodeURIComponent(quest_list[1]['author'])}&`+
                    `newGame=${window.location.href}`)
                }


                console.log(`Score: ${score}`)
                if (q_act<12){
                    initGameField()}
                else {window.location.replace(`{% url 'result-game' %}?status=win&score=${score}`)}
            }
            }

        </script>

	</body>
</html>